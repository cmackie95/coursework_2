- name: Configure kubectl on Production VM
  hosts: azure
  user: cmackie95
  become: yes

  vars:
    myResourceGroup: DevOps
    myVM: productionVM

  tasks:
  - name: Install Various Packages
    apt:
      update_cache: yes
      name: "{{ packages }}"
    vars:
      packages:
      - libssl-dev
      - libffi-dev
      - python-dev
      - python-pip
      
  - stat:
      path: /home/cmackie95/kubectl_deployment.yml
    register: result
   
  - name: Copy kubectl_deployment.yml to productionVM
    copy:
      src: ./kubectl_deployment.yml
      dest: /home/cmackie95/kubectl_deployment.yml
    when: result.stat.exists == false

  - name: Run kubectl_deployment installation script
    command: kubectl apply -f ./kubectl_deployment.yml